<!DOCTYPE html><html lang="en"><head><script>(function () {
  // Store original console methods
  const originalConsole = {
    log: console.log,
    error: console.error,
    warn: console.warn,
    info: console.info,
  };

  // Helper function to send logs to parent window
  function sendToParent(type, args) {
    const serializedArgs = args.map((arg) => {
      try {
        // Handle special cases like Error objects
        if (arg instanceof Error) {
          return {
            message: arg.message,
            stack: arg.stack,
            name: arg.name,
          };
        }
        // For other objects, try to serialize
        return JSON.parse(JSON.stringify(arg));
      } catch (e) {
        // If serialization fails, convert to string
        return String(arg);
      }
    });

    window.parent.postMessage(
      {
        type: 'console',
        logType: type,
        args: serializedArgs,
        timestamp: new Date().toISOString(),
      },
      '*'
    );
  }

  // Override console methods
  console.log = function (...args) {
    sendToParent('log', args);
    originalConsole.log.apply(console, args);
  };

  console.error = function (...args) {
    sendToParent('error', args);
    originalConsole.error.apply(console, args);
  };

  console.warn = function (...args) {
    sendToParent('warn', args);
    originalConsole.warn.apply(console, args);
  };

  console.info = function (...args) {
    sendToParent('info', args);
    originalConsole.info.apply(console, args);
  };

  // Also catch unhandled errors and promise rejections
  window.addEventListener('error', function (event) {
    sendToParent('error', [
      {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        error: event.error,
      },
    ]);
  });

  window.addEventListener('unhandledrejection', function (event) {
    sendToParent('error', [
      {
        message: 'Unhandled Promise Rejection',
        reason: event.reason,
      },
    ]);
  });
})();</script><script>(function () {
  const sendNavigation = () => {
    window.parent.postMessage(
      {
        type: 'navigation',
        path: window.location.pathname,
      },
      '*'
    );
  };

  // Intercept History API
  const originalPushState = history.pushState;
  const originalReplaceState = history.replaceState;

  history.pushState = function () {
    originalPushState.apply(this, arguments);
    sendNavigation();
  };

  history.replaceState = function () {
    originalReplaceState.apply(this, arguments);
    sendNavigation();
  };

  // Send initial navigation
  sendNavigation();

  // Listen for popstate (browser back/forward)
  window.addEventListener('popstate', sendNavigation);
})();</script><script>(function () {
  const EVENTS = [
    // Desktop events
    'mousedown',
    'keydown',
    'scroll',
    'mousemove',
    // Mobile events
    'touchstart',
    'touchmove',
    'touchend', // Touch interactions
    'orientationchange', // Orientation changes
    'devicemotion',
    'deviceorientation', // Movement/rotation
    'input',
    'change', // Form interactions
    'focusin',
    'focusout', // Element focus changes
  ];

  function handleActivity(event) {
    // Send activity event to parent window
    window.parent.postMessage({ type: 'activity', event }, '*');
  }

  // Set up event listeners for user activity
  EVENTS.forEach((event) => {
    window.addEventListener(event, () => handleActivity(event));
  });
})();</script><style type="text/css">
			.__expo_fast_refresh {
				display: none !important;
				opacity: 0 !important;
				visibility: hidden !important;
				pointer-events: none !important;
			}
		</style>
    <script type="module">import { injectIntoGlobalHook } from "/@react-refresh";
injectIntoGlobalHook(window);
window.$RefreshReg$ = () => {};
window.$RefreshSig$ = () => (type) => type;</script>

    <script type="module" src="/@vite/client"></script>

    <meta charset="UTF-8"/>
    <link rel="icon" type="image/png" href="/favicon-v2.png?v=3"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SingCity - Karaoke on Blockchain</title>
    <script>
      // Polyfill Buffer globally before any modules load
      window.global = window;
    </script>
  <script>(function () {
  // Send iframe-ready once on initialization
  window.parent.postMessage(
    {
      type: 'iframe-ready',
      reason: 'initial-load',
      timestamp: new Date().toISOString(),
    },
    '*'
  );

  // Try to set up React refresh detection, with retries
  function setupReactRefreshDetection() {
    // If React refresh is available, register our hook
    if (typeof window.__registerBeforePerformReactRefresh === 'function') {
      // Register hook for before refresh - this will clear the console
      window.__registerBeforePerformReactRefresh(function () {
        window.parent.postMessage(
          {
            type: 'console-clear',
            reason: 'react-refresh-starting',
            timestamp: new Date().toISOString(),
          },
          '*'
        );
        return true; // Don't prevent the refresh
      });

      return true; // Successfully set up
    }

    return false; // Not available yet
  }

  // Try immediately first
  if (!setupReactRefreshDetection()) {
    // If not available, retry with increasing delays
    let attempts = 0;
    const maxAttempts = 30;
    const checkInterval = setInterval(function () {
      attempts++;

      if (setupReactRefreshDetection()) {
        // Success - clear the interval
        clearInterval(checkInterval);
      } else if (attempts >= maxAttempts) {
        // Give up after max attempts
        clearInterval(checkInterval);
      }
    }, 200); // Check every 200ms
  }
})();</script><script>(() => {
  const OVERLAY_ID = '__component_overlay__';
  let overlay, label;

  // The possible states are:
  // { type: 'inactive' }
  // { type: 'inspecting', element: ?HTMLElement }
  // { type: 'selected', element: HTMLElement }
  let state = { type: 'inactive' };

  /* ---------- helpers --------------------------------------------------- */
  const css = (el, obj) => Object.assign(el.style, obj);

  function makeOverlay() {
    overlay = document.createElement('div');
    overlay.id = OVERLAY_ID;
    css(overlay, {
      position: 'absolute',
      border: '2px solid #7f22fe',
      background: 'rgba(0,170,255,.05)',
      pointerEvents: 'none',
      zIndex: '2147483647', // max
      borderRadius: '4px',
      boxShadow: '0 2px 8px rgba(0, 0, 0, 0.15)',
    });

    label = document.createElement('div');
    css(label, {
      position: 'absolute',
      left: '0',
      top: '100%',
      transform: 'translateY(4px)',
      background: '#7f22fe',
      color: '#fff',
      fontFamily: 'monospace',
      fontSize: '12px',
      lineHeight: '1.2',
      padding: '3px 5px',
      whiteSpace: 'nowrap',
      borderRadius: '4px',
      boxShadow: '0 1px 4px rgba(0, 0, 0, 0.1)',
    });
    overlay.appendChild(label);
    document.body.appendChild(overlay);
  }

  function updateOverlay(el, isSelected = false) {
    if (!overlay) makeOverlay();

    const rect = el.getBoundingClientRect();
    css(overlay, {
      top: `${rect.top + window.scrollY}px`,
      left: `${rect.left + window.scrollX}px`,
      width: `${rect.width}px`,
      height: `${rect.height}px`,
      display: 'block',
      border: isSelected ? '3px solid #7f22fe' : '2px solid #7f22fe',
      background: isSelected
        ? 'rgba(127, 34, 254, 0.05)'
        : 'rgba(0,170,255,.05)',
    });

    css(label, {
      background: '#7f22fe',
    });

    // Clear previous contents
    while (label.firstChild) {
      label.removeChild(label.firstChild);
    }

    if (isSelected) {
      const editLine = document.createElement('div');

      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('width', '12');
      svg.setAttribute('height', '12');
      svg.setAttribute('viewBox', '0 0 16 16');
      svg.setAttribute('fill', 'none');
      Object.assign(svg.style, {
        display: 'inline-block',
        verticalAlign: '-2px',
        marginRight: '4px',
      });
      const path = document.createElementNS(svgNS, 'path');
      path.setAttribute(
        'd',
        'M8 0L9.48528 6.51472L16 8L9.48528 9.48528L8 16L6.51472 9.48528L0 8L6.51472 6.51472L8 0Z'
      );
      path.setAttribute('fill', 'white');
      svg.appendChild(path);

      editLine.appendChild(svg);
      editLine.appendChild(document.createTextNode('Edit with AI'));
      label.appendChild(editLine);
    }

    const name = el.dataset.componentName || '<unknown>';
    const file = (el.dataset.componentId || '').split(':')[0];

    const nameEl = document.createElement('div');
    nameEl.textContent = name;
    label.appendChild(nameEl);

    if (file) {
      const fileEl = document.createElement('span');
      css(fileEl, { fontSize: '10px', opacity: '.8' });
      fileEl.textContent = file;
      label.appendChild(fileEl);
    }
  }

  /* ---------- event handlers -------------------------------------------- */
  function onMouseMove(e) {
    if (state.type !== 'inspecting') {
      console.log(
        'ðŸ”§ Mouse move ignored - not in inspecting state:',
        state.type
      );
      return;
    }

    let el = e.target;
    console.log('ðŸ”§ Mouse move - target element:', el.tagName, el.className);

    while (el && !el.dataset.componentId) el = el.parentElement;

    if (el) {
      console.log(
        'ðŸ”§ Found element with component-id:',
        el.dataset.componentId,
        el.dataset.componentName
      );
    } else {
      console.log('ðŸ”§ No element with component-id found');
    }

    if (state.element === el) return;
    state.element = el;

    if (el) {
      console.log('ðŸ”§ Updating overlay for element');
      updateOverlay(el, false);
    } else {
      console.log('ðŸ”§ Hiding overlay - no valid element');
      if (overlay) overlay.style.display = 'none';
    }
  }

  function onClick(e) {
    if (state.type !== 'inspecting' || !state.element) return;
    e.preventDefault();
    e.stopPropagation();

    state = { type: 'selected', element: state.element };
    updateOverlay(state.element, true);

    window.parent.postMessage(
      {
        type: 'component-selected',
        id: state.element.dataset.componentId,
        name: state.element.dataset.componentName,
      },
      '*'
    );
  }

  /* ---------- activation / deactivation --------------------------------- */
  function activate() {
    console.log(
      'ðŸ”§ Component selector activate() called, current state:',
      state.type
    );
    if (state.type === 'inactive') {
      console.log('ðŸ”§ Adding event listeners for mousemove and click');
      window.addEventListener('mousemove', onMouseMove, true);
      window.addEventListener('click', onClick, true);
    }
    state = { type: 'inspecting', element: null };
    console.log('ðŸ”§ State changed to inspecting');
    if (overlay) {
      overlay.style.display = 'none';
    }
  }

  function deactivate() {
    if (state.type === 'inactive') return;

    window.removeEventListener('mousemove', onMouseMove, true);
    window.removeEventListener('click', onClick, true);
    if (overlay) {
      overlay.remove();
      overlay = null;
      label = null;
    }
    state = { type: 'inactive' };
  }

  /* ---------- message bridge -------------------------------------------- */
  window.addEventListener('message', (e) => {
    if (e.source !== window.parent) return;
    if (e.data.type === 'activate-component-selector') {
      activate();
    }
    if (e.data.type === 'deactivate-component-selector') {
      deactivate();
    }
  });

  function initializeComponentSelector() {
    if (!document.body) {
      console.error(
        'Component selector initialization failed: document.body not found.'
      );
      return;
    }

    let attempts = 0;
    const maxAttempts = 50;
    const checkInterval = 100;

    function checkForTaggedElements() {
      if (document.body.querySelector('[data-component-id]')) {
        window.parent.postMessage(
          {
            type: 'component-selector-initialized',
          },
          '*'
        );
        console.debug('Component selector initialized');
        return;
      }

      attempts++;
      if (attempts < maxAttempts) {
        setTimeout(checkForTaggedElements, checkInterval);
      } else {
        console.warn(
          'Component selector not initialized because no DOM elements were tagged'
        );
      }
    }

    checkForTaggedElements();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeComponentSelector);
  } else {
    initializeComponentSelector();
  }
})();</script></head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx?t=1762766587076"></script>
  

</body></html>